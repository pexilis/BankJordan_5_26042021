(()=>{var t={4:()=>{null===localStorage.getItem("cart-storage")&&localStorage.setItem("cart-storage","[]"),null===localStorage.getItem("command-storage")&&localStorage.setItem("command-storage","[]")},809:(t,e)=>{}},e={};function r(a){var o=e[a];if(void 0!==o)return o.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,r),n.exports}r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};r.r(t),r.d(t,{ConfigValidator:()=>l,DOMApi:()=>y,Global:()=>s,JSONManip:()=>d,LocalStorageAPI:()=>i,RequestFactory:()=>p});var e={};r.r(e),r.d(e,{Cart:()=>C,Command:()=>R,Product:()=>E});var a={};r.r(a),r.d(a,{CartError:()=>f,CommandError:()=>w});var o={};r.r(o),r.d(o,{CartCalculate:()=>I,CartSubmit:()=>P,CommandCalculate:()=>x});var n={};r.r(n),r.d(n,{AddArticle:()=>S,ChangeQuantity:()=>v,DeleteArticle:()=>O,GenerateCommand:()=>q,LoadPage:()=>A,SubmitCart:()=>b});const s={protocol:"https",hostname:"orinoco-back.herokuapp.com",typeData:"cameras",maxQuantityCart:10},i=class extends class{constructor(t){this.name=t}errorUndefined(t){if(void 0===t)throw{error:"UNDEFINED_ERROR"}}errorInit(){if(!this.isInitialized())throw{error:"INITIALIZATION_ERROR"}}errorEmpty(){if(this.errorInit(),this.isEmpty())throw{error:"EMPTY_ERROR"}}errorAccess(t){if(void 0===this.getArray(this.name).find((e=>e._id===t)))throw{error:"ACCESS_ERROR"}}}{isInitialized(){return null!==localStorage.getItem(this.name)}getArray(){return this.errorInit(),JSON.parse(localStorage.getItem(this.name))}isEmpty(){return this.errorInit(),0===JSON.parse(localStorage.getItem(this.name)).length}clearArray(){this.errorInit(),this.errorEmpty(),localStorage.setItem(this.name,"[]")}getById(t){return this.errorInit(),this.getArray(this.name).find((e=>e._id===t))}addItem(t){const e=this.getArray(this.name);e.push(t),localStorage.setItem(this.name,JSON.stringify(e))}setById(t,e){this.errorInit(),this.errorAccess(t);let r=this.getArray(name);for(let a=0;a<r.length;a++)r[a]._id===t&&(r[a]=e);localStorage.setItem(this.name,JSON.stringify(r))}removeItem(t){this.errorInit(),this.errorEmpty(),this.errorAccess(t);let e=this.getArray();e=e.filter((e=>e._id!==t)),localStorage.setItem(this.name,JSON.stringify(e))}},c=(()=>{let t={};const e={};return t.addRegex=(t,r)=>{e[t]=new RegExp(r)},t.checkRegex=t=>({valid:Object.entries(t).every((t=>{const r=t[0],a=t[1],o=e[r];let n;return n="object"==typeof a?a.every((t=>o.test(t))):o.test(a),n})),result:t}),t})();c.addRegex("name","^[a-zA-Z]{3,25}$"),c.addRegex("city","^[a-zA-Z]+(?:[s-][a-zA-Z]+)*$"),c.addRegex("address","^[0-9]{1,2}[a-zA-Z ]{2,45}$"),c.addRegex("email",/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/),c.addRegex("orderId","^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$"),c.addRegex("uuid","^[0-9a-z]{24}$"),c.addRegex("quantity","^[0-9]{1,2}$"),c.addRegex("price","^[0-9]{1,}00$");const l=c,d=(()=>{let t={stringifyJSON:e=>{if(null===e||"object"!=typeof e)return!1;Object.entries(e).map((([r,a])=>{"number"==typeof a&&(e[r]=a.toString()),t.stringifyJSON(a)}))},genericJSON:async e=>{let r;try{r=await e.json()}catch(t){throw{error:"JSON_ERROR"}}return t.stringifyJSON(r),r},formToJSON:(t,e)=>{const r=new FormData(t),a={};return e.map((t=>{const e=r.get(t);a[t]=e})),a}};return t})(),u=async(t,e,r,a)=>{let o;try{["GET","DELETE"].includes(e)&&(o=await fetch(t,{method:e,headers:r})),["POST","PUT","PATCH"].includes(e)&&(o=await fetch(t,{method:e,headers:r,body:JSON.stringify(a)}))}catch(t){throw{error:"NETWORK_ERROR"}}if(o.status>=400&&o.status<500)throw{error:"CLIENT_ERROR"};if(o.status>=500&&o.status<600)throw{error:"SERVER_ERROR"};return o};class m extends class{constructor(t,e){if(!["GET","DELETE"].includes(t))throw{error:"URLREQUEST_ERROR"};this.method=t,this.url=e}}{async send(t){let e,r=function(t,e){let r="?";return e?(Object.entries(e).map((([e,a])=>{const o=encodeURIComponent(a);t.includes(`{${e}}`)?t=t.replace(`{${e}}`,o):r+=`${e}=${o}&`})),r=r.slice(0,-1),t+=r):t}(this.url,t);return e=await u(r,this.method,{Accept:"application/json"},t),d.genericJSON(e)}}const h=(()=>{let t={},e={};return t.add=(t,r)=>{e[t]=r},t.get=t=>e[t],t})();h.add("submitCart",new class extends class{constructor(t,e){if(!["POST","PUT","PATCH"].includes(t))throw{error:"BODYREQUEST_ERROR"};this.method=t,this.url=e}}{async send(t){let e;return e=await u(this.url,this.method,{"Content-Type":"application/json"},t),d.genericJSON(e)}}("POST",`${s.protocol}://${s.hostname}/api/${s.typeData}/order`)),h.add("getProducts",new m("GET",`${s.protocol}://${s.hostname}/api/${s.typeData}`)),h.add("getProductById",new m("GET",`${s.protocol}://${s.hostname}/api/${s.typeData}/{id}`));const p=h,y={findParentNode:(t,e)=>{let r=t,a=r.classList.contains(e);for(;!a;)r=r.parentNode,a=r.classList.contains(e);return r}};r(4),r(809);const g=(()=>{let t={updatePaidPrice:(t,e)=>{const r=Number.parseInt(t.quantity,10)*Number.parseInt(t.price.slice(0,-2));t.calculatePrice=r.toString()},updateArticleWithNewQuantity:(e,r,a)=>{const{CartModel:o,CartError:n}=a.getEveryDependencies();let s=Number.parseInt(e.quantity)+Number.parseInt(r.quantity);s=s.toString(),r.quantity=s,t.updatePaidPrice(r);try{n.errorFormat(r)}catch(t){throw{error:"ADD_ERROR"}}o.setById(r._id,r)}};return t})(),C=class{constructor(t,e,r){this.CartModel=t,this.RequestFactory=e,this.CartError=r}getEveryDependencies(){const{CartModel:t,RequestFactory:e,CartError:r}=this;return{CartModel:t,RequestFactory:e,CartError:r}}async listArticles(){const{CartError:t,CartModel:e}=this.getEveryDependencies();let r=e.getArray();return r.map((e=>t.errorFormat(e))),Promise.resolve(r)}clearCart(){const{CartModel:t}=this.getEveryDependencies();t.clearArray()}addArticle(t){const{CartModel:e,CartError:r}=this.getEveryDependencies();r.errorFormat(t);const a=e.getById(t._id);return a?g.updateArticleWithNewQuantity(a,t,this):(g.updatePaidPrice(t,this),e.addItem(t)),e.getById(t._id)}removeArticle(t){const{CartModel:e,CartError:r}=this.getEveryDependencies();r.errorID(t);let a=e.getById(t);return e.removeItem(t),a}setArticleById(t,e){const{CartModel:r,CartError:a}=this.getEveryDependencies();return a.errorID(t),a.errorFormat(e),r.removeItem(t),this.addArticle(e),e}getArticleById(t){const{CartModel:e,CartError:r}=this.getEveryDependencies();return r.errorID(t),e.getById(t)}async getEveryProductsId(){let t=await this.listArticles(),e=[];return t.map((t=>{const r=Number.parseInt(t.quantity),a=t._id;for(let t=0;t<r;t++)e.push(a)})),e}},E=class{constructor(t,e,r){this.RequestFactory=t,this.Validator=e,this.CartError=r}async fetchEvery(){const{RequestFactory:t}=this;let e=t.get("getProducts");return await e.send()}async fetchById(t){const{CartError:e}=this;e.errorID(t);let r=RequestFactory.get("getProductById");return await r.send({id:t})}},R=class{constructor(t,e){this.CommandModel=t,this.CommandError=e}getEveryDependencies(){const{CommandModel:t,CommandError:e}=this;return{CommandModel:t,CommandError:e}}add(t){const{CommandModel:e,CommandError:r}=this;t._id=t.orderId,e.addItem(t)}get(t){const{CommandModel:e,CommandError:r}=this;return r.errorUUID(t),e.getById(t)}},f=class{constructor(t,e){this.Validator=t,this.CartModel=e}errorFormat(t){const{Validator:e}=this;if(!1===e.checkRegex({uuid:t._id,quantity:t.quantity,price:t.price}).valid)throw{error:"FORMAT_ERROR"}}errorSubmit(t){const{Validator:e}=this;if(!e.checkRegex({name:[t.firstName,t.lastName],city:t.city,address:t.address,email:t.email}).valid)throw{error:"FORMAT_ERROR"}}errorProducts(){const{CartModel:t,Validator:e}=this,r=t.getArray();for(let t=0;t<r.length;t++){const a=r[t]._id;if(!e.checkRegex({uuid:a}).valid)throw{error:"FORMAT_ERROR"}}}errorID(t){const{Validator:e}=this;if(!1===e.checkRegex({uuid:t}).valid)throw{error:"FORMAT_ERROR"}}},w=class{constructor(t){this.Validator=t}errorUUID(t){const{Validator:e}=this;if(!e.checkRegex({orderId:t}).valid)throw{error:"FORMAT_ERROR"}}},I=class{constructor(t){this.Cart=t}totalPrices(){const{Cart:t}=this,{CartModel:e,CartError:r}=t.getEveryDependencies(),a=e.getArray();let o=[];return 0===a.length?0:(o=a.map((t=>(r.errorFormat(t),Number.parseInt(t.calculatePrice,10)))),o.reduce(((t,e)=>t+e)))}quantities(){const{Cart:t}=this,{CartModel:e,CartError:r}=t.getEveryDependencies(),a=e.getArray();let o=[];return 0===a.length?0:(o=a.map((t=>(r.errorFormat(t),Number.parseInt(t.quantity)))),o.reduce(((t,e)=>t+e)))}},P=class{constructor(t){this.Cart=t}async submit(t){const{Cart:e}=this,{CartError:r,RequestFactory:a,CartModel:o}=e.getEveryDependencies();r.errorSubmit(t),r.errorProducts(),o.errorEmpty();const n=await e.getEveryProductsId();let s=a.get("submitCart");return await s.send({contact:t,products:n})}},x=class{constructor(t){this.Command=t}totalPrice(t){const{Command:e}=this;return e.get(t).products.map((t=>{const e=t.price;let r=e.slice(0,e.length-2);return Number.parseInt(r)})).reduce(((t,e)=>t+e))}},S=class{constructor(t,e){this.Cart=t,this.CartCalculate=e}async run(t){const{Cart:e,CartCalculate:r}=this,a=e.addArticle(t);return{addedArticle:a,minQuantitySelected:1,maxQuantitySelected:10-a.quantity,totalProducts:r.quantities()}}},v=class{constructor(t,e){this.Cart=t,this.CartCalculate=e}async cart(t){const{Cart:e,CartCalculate:r}=this;if([t.id,t.quantity].includes(void 0))throw new{error:"UNDEFINED_ERROR"};const a=t.id;let o=t.quantity;const n=e.getArticleById(a);if(void 0===n)return{articleModified:void 0};n.quantity=o,e.setArticleById(a,n);const s=r.totalPrices();return o=r.quantities(),{updatedPrice:n.calculatePrice,totalPrice:s.toString(),quantity:o}}async page(t){if([t.price,t.quantity].includes(void 0))throw new{error:"UNDEFINED_ERROR"};let e=Number.parseInt(t.quantity);return Number.parseInt(t.price.slice(0,t.price.length-2))*e}},O=class{constructor(t,e){this.Cart=t,this.CartCalculate=e}async run(t){const{Cart:e,CartCalculate:r}=this;return{article:e.removeArticle(t),totalPrice:r.totalPrices(),quantity:r.quantities()}}},A=class{constructor(t,e,r){this.Cart=e,this.Product=t,this.CartCalculate=r}async cart(){const{Cart:t,CartCalculate:e}=this;return{clientProducts:await t.listArticles(),totalPrice:e.totalPrices()}}async index(){const{Product:t}=this;return{serverProducts:await t.fetchEvery()}}async header(){const{CartCalculate:t}=this;return{totalProducts:t.quantities()}}async article(t){const{Product:e,Cart:r}=this,a=await e.fetchById(t),o=await r.getArticleById(t);let n,i;return o?(i=Number.parseInt(o.quantity),n=s.maxQuantityCart-i):n=s.maxQuantityCart,{maxQuantitySelected:n,selectedProduct:a}}},b=class{constructor(t,e,r){this.Cart=t,this.CartSubmit=e,this.Command=r}async run(t){const{CartSubmit:e,Cart:r,Command:a}=this;let o=await e.submit(t);return a.add(o),r.clearCart(),{result:o}}},q=class{constructor(t,e){this.Command=t,this.CommandCalculate=e}async run(t){const{Command:e,CommandCalculate:r}=this,a=e.get(t).contact,{firstName:o,lastName:n,city:s,address:i,email:c}=a;return{firstName:o,lastName:n,city:s,address:i,email:c,totalPrice:r.totalPrice(t)}}};Object.entries(t).forEach((([t,e])=>window[t]=e)),Object.entries(e).forEach((([t,e])=>window[t]=e)),Object.entries(a).forEach((([t,e])=>window[t]=e)),Object.entries(o).forEach((([t,e])=>window[t]=e)),Object.entries(n).forEach((([t,e])=>window[t]=e));const _=(()=>{let t={data:{},place:{}};return t.selectQuantity=document.querySelector("#quantity"),t.selectLenses=document.querySelector("#lenses"),t.nameProduct=document.querySelector(".form__header h1"),t.priceProduct=document.querySelector(".form__header span"),t.descriptionProduct=document.querySelector(".form__description p"),t.totalPriceElement=document.querySelector(".form__price span"),t.productButton=document.querySelector(".form__button"),t.buttonLoader=document.querySelector(".btn__loader"),t.productContainer=document.querySelector(".l-product"),t.place.image=document.querySelector('div[data-place="image"]'),t.init=()=>{const e=window.location.search,r=new URLSearchParams(e).get("id");t.data.id=r},t.drawQuantity=e=>{let r=t.selectQuantity;r.innerHTML="";for(let t=1;t<=e;t++){const e=document.createElement("option");e.setAttribute("value",t),e.textContent=t,r.appendChild(e)}r.classList.add("apparition")},t.drawLenses=e=>{let r=t.selectLenses;r.innerHTML="",e.forEach((t=>{const e=document.createElement("option");e.setAttribute("value",t),e.textContent=t,r.appendChild(e)})),r.classList.add("apparition")},t.generateImage=t=>{let e=document.createElement("img");return e.className="l-product__img apparition",e.setAttribute("src",t),e},t.drawInfos=e=>{let r=t.nameProduct,a=t.priceProduct,o=t.descriptionProduct;const n=e.name,s=`${e.price.slice(0,e.price.length-2)}€`,i=e.description;document.title=`Orinoco - Appareil Photo - ${n}`,r.classList.add("apparition"),a.classList.add("apparition"),o.classList.add("apparition"),r.textContent=n,a.textContent=s,o.textContent=i},t.drawTotalPrice=e=>{const r=`Prix total : ${e}€`;t.totalPriceElement.textContent=r},t.drawImage=e=>{const{productContainer:r,place:a}=t,o=t.generateImage(e);r.replaceChild(o,a.image)},t})();_.data.quantity=1;const M=_,N=(()=>{let t={};return t.counterElement=document.querySelector(".l-header__counter"),t.modalWrapper=document.querySelector(".wrapper--modal"),t.modal=document.querySelector(".modal"),t.modalDescription=document.querySelector(".modal__description"),t.clientMessage="Veuillez-nous excuser mais l'article que vous recherchez n'est actuellement pas disponsible à la vente.",t.formatMessage="Format du lien incorrect, veuillez contacter l'assistance technique si le problème persiste",t.networkMessage="Veuillez-nous excuser mais notre service est actuellement indisponible. Merci de revenir plus tard",t.formatCartMessage="Formulaire invalide. Veuillez rentrer des informations conformes",t.formatBadQuantity="La quantité fourni n'est pas conforme aux attentes. Veuillez contacter le service technique si le problème persiste",t.formatBadCart="Il semble que le panier soit corrompue. Veuillez contacter le service technique pour de l'aide",t.genericBadFormat="Les informations reçues par l'application ne sont pas correctes. Veuillez contacter le service technique si le problème persiste",t.place=[],t.drawQuantities=e=>{t.counterElement.style.display="none",e>0&&(t.counterElement.textContent=e,t.counterElement.style.display="flex")},t.closeModal=()=>{const{modalDescription:e,modalWrapper:r,modal:a}=t;r.style.display="none",a.style.display="none"},t.showModal=e=>{const{modalDescription:r,modalWrapper:a,modal:o}=t;r.textContent=e,a.style.display="block",o.style.display="block"},t.startAnimation=(t,e)=>{e.classList.add("active"),setTimeout((()=>{e.classList.remove("active")}),t)},t})();(()=>{for(let t=0;t<6;t++){const e=document.querySelector(`div[data-place="${t}"]`);N.place[t]=e}N.modal.onclick=t=>{const{target:e}=t,{classList:r}=e;"path"===e.tagName&&N.closeModal()}})();const D=N;M.init();const T=new LocalStorageAPI("cart-storage"),L=new CartError(ConfigValidator,T),F=new Cart(T,RequestFactory,L),z=new CartCalculate(F),$=new Product(RequestFactory,ConfigValidator,L),B=new LoadPage($,F,z),Q=new AddArticle(F,z),V=new ChangeQuantity(F,z);let j=M.data,{id:U}=j,{selectQuantity:J,productButton:k,counterElement:W,buttonLoader:G,place:Z,productContainer:H}=M;document.addEventListener("DOMContentLoaded",(()=>{B.header().then((t=>{const{totalProducts:e}=t;D.drawQuantities(e)})).catch((t=>{"FORMAT_ERROR"===t.error&&D.showModal(D.formatBadCart)})),B.article(U).then((t=>{const{selectedProduct:e,maxQuantitySelected:r,totalProducts:a}=t,{lenses:o,imageUrl:n,name:s}=e;j.selectedProduct=t.selectedProduct,M.drawImage(n),M.drawQuantity(r),M.drawLenses(o),M.drawInfos(e)})).catch((t=>{"CLIENT_ERROR"===t.error&&D.showModal(D.clientMessage),"FORMAT_ERROR"===t.error&&D.showModal(D.formatMessage),"NETWORK_ERROR"===t.error&&D.showModal(D.networkMessage)})),J.addEventListener("change",(t=>{const{target:e}=t,{value:r}=e,{price:a}=j.selectedProduct;j.quantity=r,V.page({quantity:r,price:a}).then((t=>{M.drawTotalPrice(t)}))})),k.addEventListener("click",(t=>{console.log("LOL"),t.preventDefault();const{quantity:e}=j;j.selectedProduct.quantity=e,Q.run(j.selectedProduct).then((t=>{const{totalProducts:e,maxQuantitySelected:r}=t;j.quantity=1,M.drawQuantity(r),D.drawQuantities(e),D.startAnimation(1200,G)})).catch((t=>{"FORMAT_ERROR"===t.error&&D.showModal(D.genericBadFormat)}))}))}))})()})();